<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ú—ñ–π –∞–∫–∞—É–Ω—Ç ‚Äì √âlite Cuisine</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    .profile-card {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      height: 100%;
    }
    .order-card {
      background-color: #ffffff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .profile-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 10px;
    }
    .profile-card p {
      font-size: 35px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <main>

      <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item me-4"><a class="nav-link" href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a></li>
              <li class="nav-item me-4"><a class="nav-link" href="about.html">–ü—Ä–æ –Ω–∞—Å</a></li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">–ö–µ–π—Ç–µ—Ä–∏–Ω–≥ —É—Å—ñ—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="menu_Open_Air.html">Open-Air –∫–µ–π—Ç–µ—Ä–∏–Ω–≥</a></li>
                  <li><a class="dropdown-item" href="menu_coffee_break.html">Coffee-break</a></li>
                  <li><a class="dropdown-item" href="menu_for_foto.html">–ö–µ–π—Ç–µ—Ä–∏–Ω–≥ –¥–ª—è –∑–π–æ–º–æ–∫</a></li>
                  <li><a class="dropdown-item" href="menu_wedding.html">–í–µ—Å—ñ–ª—å–Ω–∏–π –∫–µ–π—Ç–µ—Ä–∏–Ω–≥</a></li>
                  <li><a class="dropdown-item" href="menu_buffets.html">–§—É—Ä—à–µ—Ç–∏</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="menu_banket.html">–ë–∞–Ω–∫–µ—Ç–∏</a></li>
                  <li><a class="dropdown-item" href="menu_private_parties.html">–ü—Ä–∏–≤–∞—Ç–Ω—ñ –≤–µ—á—ñ—Ä–∫–∏</a></li>
                  <li><a class="dropdown-item" href="menu_corporate_events.html">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ñ –ø–æ–¥—ñ—ó</a></li>
                  <li><a class="dropdown-item" href="menu_bar_catering.html">–ë–∞—Ä–Ω–∏–π –∫–µ–π—Ç–µ—Ä–∏–Ω–≥</a></li>
                  <li><a class="dropdown-item" href="menu_B2B_catering.html">B2B –∫–µ–π—Ç–µ—Ä–∏–Ω–≥</a></li>
                </ul>
              </li>
              <li class="nav-item me-4"><a class="nav-link" href="online_order.html">–ó—Ä–æ–±–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</a></li>
              <li class="nav-item me-4"><a class="nav-link" href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>

            </ul>
            <ul class="navbar-nav">
              <li class="nav-item login-nav-item">
                <a class="nav-link" href="login.html">–£–≤—ñ–π—Ç–∏</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <div class="line"></div>

      <div class="container mt-5">
        <h1 class="mb-4 text-center">–ú—ñ–π –∞–∫–∞—É–Ω—Ç</h1>
        <div id="accountContent" class="row justify-content-center"></div>
      </div>
    </main>

    <div class="footer">
      <div class="line"></div>

      <div class="contact-section">
        <div class="left-block">
          <div class="text">
            –¢–µ–ª–µ—Ñ–æ–Ω: +38067-620-7495<br>
            Email: info@cateringTernopil.com.ua<br>
            –º.–¢–µ—Ä–Ω–æ–ø—ñ–ª—å, –≤—É–ª. –†–æ–º–∞–Ω–∞ –ö—É–ø—á–∏–Ω—Å—å–∫–æ–≥–æ, 1–ê
          </div>
          <ul class="text1">
            <li><a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a></li>
            <li><a href="menu_Open_Air.html">–ö–µ–π—Ç–µ—Ä–∏–Ω–≥ —É—Å—ñ—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤</a></li>
            <li><a href="about.html">–ü—Ä–æ –Ω–∞—Å</a></li>
            <li><a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
          </ul>
          
        </div>
          <div class="map-container">
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1294.1247789690258!2d25.639790238930434!3d49.5553142328454!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x473033ef8af73d29%3A0xf7c87aba1cd10b91!2z0JzQsNC90LTQsNGA0LjQvQ!5e0!3m2!1suk!2sua!4v1748584793412!5m2!1suk!2sua" 
          width="400" 
          height="230" 
          style="border:0;" 
          allowfullscreen="" 
          loading="lazy" 
          referrerpolicy="no-referrer-when-downgrade">
      </iframe>
      </div>
      </div>
      <div class="line"></div>
      <div class="linefooter">
          <ul class="text2">
            <li>
              <a href="index.html">
                <img src="foto/free-icon-home-7133312.png" alt="">
                –ì–æ–ª–æ–≤–Ω–∞
              </a>
            </li>
            <li>
              <a href="online_order.html">
                <img src="foto/free-icon-restaurant-1980788.png" alt="">
                –ó–∞–∫–∞–∑–∞—Ç–∏
              </a>
            </li>
            <li>
              <a href="reviews.html">
                <img src="foto/free-icon-email-2258861.png" alt="">
                –í—ñ–¥–≥—É–∫–∏
              </a>
            </li>
            <li>
              <a href="account.html">
                <img src="foto/free-icon-avatar-6386976.png" alt="">
                –ú—ñ–π –∞–∫–∞—É–Ω—Ç
              </a>
            </li>              
          </ul>
        </div>
        
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC-7vXgyOD4TZFNKpUGmQheLpY5fQgdA64",
      authDomain: "proect-7468b.firebaseapp.com",
      projectId: "proect-7468b",
      storageBucket: "proect-7468b.appspot.com",
      messagingSenderId: "251531415961",
      appId: "1:251531415961:web:76e6230edb601a22404308"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const loginNavItem = document.querySelector(".login-nav-item");

    onAuthStateChanged(auth, user => {
      if (user) {
        const displayName = user.displayName || user.email.split("@")[0];
        const email = user.email;

        localStorage.setItem("userProfile", JSON.stringify({
          name: displayName,
          email: email,
          phone: user.phoneNumber || ''
        }));

        loginNavItem.innerHTML = `
          <div class="user-info d-flex align-items-center">
            <span class="nav-link user-name">üë§ ${displayName}</span>
            <a href="#" class="nav-link text-danger" id="logout-link">–í–∏–π—Ç–∏</a>
          </div>
        `;

        document.getElementById("logout-link").addEventListener("click", async (e) => {
          e.preventDefault();
          await signOut(auth);
          localStorage.removeItem("userProfile");
          window.location.href = "login.html";
        });

      } else {
        localStorage.removeItem("userProfile");
        loginNavItem.innerHTML = `<a class="nav-link" href="login.html">–£–≤—ñ–π—Ç–∏</a>`;
      }
    });

    // Account rendering
    const accountContent = document.getElementById("accountContent");

    function getOrderKey(user) {
      return 'userOrders_' + (user?.email || 'guest');
    }

    function renderAccount() {
      const userProfile = JSON.parse(localStorage.getItem('userProfile'));
      const orderKey = getOrderKey(userProfile);
      const orders = JSON.parse(localStorage.getItem(orderKey)) || [];

      if (!userProfile) {
        accountContent.innerHTML = `
          <div class="alert alert-warning text-center">
            <h5>–í–∏ —â–µ –Ω–µ –≤–≤—ñ–π—à–ª–∏ –≤ –∞–∫–∞—É–Ω—Ç.</h5>
            <p><a href="login.html" class="btn btn-primary mt-2">–£–≤—ñ–π—Ç–∏</a></p>
          </div>`;
        return;
      }

      let ordersHTML = `<p>–£—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: <strong>${orders.length}</strong></p>`;

      if (orders.length === 0) {
        ordersHTML += `<div class="alert alert-info">–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å.</div>`;
      } else {
        orders.forEach((order, index) => {
          ordersHTML += `
            <div class="order-card">
              <h5>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ${index + 1}</h5>
              <ul class="list-group mt-3">
                <li class="list-group-item"><strong>–§–æ—Ä–º–∞—Ç –∫–µ–π—Ç–µ—Ä–∏–Ω–≥—É:</strong> ${order.eventType}</li>
                <li class="list-group-item"><strong>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ—Å—Ç–µ–π:</strong> ${order.guests}</li>
                <li class="list-group-item"><strong>–î–∞—Ç–∞ –ø–æ–¥—ñ—ó:</strong> ${order.date}</li>
                <li class="list-group-item"><strong>–õ–æ–∫–∞—Ü—ñ—è:</strong> ${order.location}</li>
                <li class="list-group-item"><strong>–ö–æ–º–µ–Ω—Ç–∞—Ä:</strong> ${order.comment || '–Ω–µ–º–∞—î'}</li>
              </ul>
              <button class="btn btn-outline-primary mt-3 me-2" onclick="editOrder(${index})">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
              <button class="btn btn-outline-danger mt-3" onclick="deleteOrder(${index})">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            </div>
          `;
        });
      }

      accountContent.innerHTML = `
        <div class="row">
          <div class="col-md-4 mb-4">
            <div class="profile-card text-center">
              <img src="foto/free-icon-avatar-6386976.png" alt="Avatar" class="profile-avatar">
              <h4>${userProfile.name || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'}</h4>
              <p class="text-muted">${userProfile.email || 'email –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'}</p>
              <p class="text-muted">${userProfile.phone || '—Ç–µ–ª–µ—Ñ–æ–Ω –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'}</p>
              <button class="btn btn-outline-danger btn-sm mt-2" onclick="logout()">–í–∏–π—Ç–∏</button>
            </div>
          </div>
          <div class="col-md-8">
            <div class="order-card">
              ${ordersHTML}
              <button class="btn btn-outline-success mt-3" onclick="window.location.href='online_order.html'">–ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
            </div>
          </div>
        </div>
      `;
    }

    async function logout() {
  try {
    await signOut(auth);
    localStorage.removeItem("userProfile");
    window.location.href = "index.html";
  } catch (error) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ:", error);
    alert("–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –≤–∏—Ö–æ–¥—É. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
  }
}

window.logout = logout; 


    window.editOrder = function (index) {
      const userProfile = JSON.parse(localStorage.getItem('userProfile'));
      const orderKey = getOrderKey(userProfile);
      const orders = JSON.parse(localStorage.getItem(orderKey)) || [];
      const order = orders[index];

      accountContent.innerHTML = `
        <h3 class="mb-4 text-center">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ${index + 1}</h3>
        <form id="editOrderForm" class="row g-3">
          <div class="col-md-6">
            <label class="form-label">–¢–∏–ø –ø–æ–¥—ñ—ó</label>
            <input type="text" class="form-control" name="eventType" value="${order.eventType || ''}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ—Å—Ç–µ–π</label>
            <input type="number" class="form-control" name="guests" value="${order.guests || ''}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">–î–∞—Ç–∞ –ø–æ–¥—ñ—ó</label>
            <input type="date" class="form-control" name="date" value="${order.date || ''}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">–õ–æ–∫–∞—Ü—ñ—è</label>
            <input type="text" class="form-control" name="location" value="${order.location || ''}" required>
          </div>
          <div class="col-12">
            <label class="form-label">–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
            <textarea class="form-control" name="comment" rows="3">${order.comment || ''}</textarea>
          </div>
          <div class="col-12 text-center">
            <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            <button type="button" class="btn btn-secondary ms-2" onclick="renderAccount()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
          </div>
        </form>
      `;

      document.getElementById('editOrderForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(this);
        const updatedOrder = Object.fromEntries(formData.entries());
        orders[index] = updatedOrder;
        localStorage.setItem(orderKey, JSON.stringify(orders));
        renderAccount();
      });
    };

    window.deleteOrder = function (index) {
      const userProfile = JSON.parse(localStorage.getItem('userProfile'));
      const orderKey = getOrderKey(userProfile);
      const orders = JSON.parse(localStorage.getItem(orderKey)) || [];
      if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?")) {
        orders.splice(index, 1);
        localStorage.setItem(orderKey, JSON.stringify(orders));
        renderAccount();
      }
    };

    renderAccount();
  </script>
</body>
</html>
