<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Вхід користувача</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

        <link rel="stylesheet" href="style.css">
  <style>
    * {
      box-sizing: border-box;
    }
    
    .main {
      background: linear-gradient(135deg, #f9dccd 0%, #5C4033 100%);
      color: #333;
      min-height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      margin: 0;
    }

    .container {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
      max-width: 420px;
      width: 100%;
      padding: 30px 40px;
      text-align: center;
    }

    h1 {
      margin-bottom: 25px;
      color: #5C4033;
      font-weight: 700;
      font-size: 2.2rem;
    }

    h3 {
      color: #444;
      margin-bottom: 20px;
      font-weight: 600;
      font-size: 1.25rem;
    }

    input[type="email"],
    input[type="password"],
    input[type="text"] {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    input[type="email"]:focus,
    input[type="password"]:focus,
    input[type="text"]:focus {
      border-color: #2575fc;
      outline: none;
      box-shadow: 0 0 8px rgba(37,117,252,0.5);
    }

    button {
      background: #9E6F55;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
      margin-top: 10px;
      box-shadow: 0 4px 12px rgba(252, 148, 37, 0.4);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    button:hover {
      background: #5C4033;
      box-shadow: 0 6px 18px rgba(121, 65, 0, 0.7);
    }
    button:active {
      background: #5C4033;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .register-form {
      display: none;
    }

    p {
      font-size: 0.9rem;
      color: #666;
      margin-top: 15px;
    }
    p a {
      color: #2575fc;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
    }
    p a:hover {
      color: #1a54d1;
      text-decoration: underline;
    }

    #logout {
      width: auto;
      padding-left: 35px;
      padding-right: 35px;
      margin: 0 auto;
      display: none;
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
      background: #dc3545;
    }
    #logout:hover {
      background: #b52a32;
      box-shadow: 0 6px 18px rgba(181, 42, 50, 0.7);
    }
    #logout:active {
      background: #8a1f26;
    }

    .or-section h3 {
      color: #555;
      margin: 20px 0 10px;
      font-weight: 500;
      font-style: italic;
      font-size: 1.1rem;
    }

    @media (max-width: 480px) {
      .container {
        padding: 20px 25px;
      }
      h1 {
        font-size: 1.8rem;
      }
      button {
        font-size: 0.95rem;
        padding: 10px 20px;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item me-4">
            <a class="nav-link" aria-current="page" href="index.html">Головна</a>
          </li>
          <li class="nav-item me-4">
            <a class="nav-link" href="about.html">Про нас</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Кейтеринг усіх форматів 
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="menu_Open_Air.html">Open-Air кейтеринг</a></li>
              <li><a class="dropdown-item" href="menu_coffee_break.html">Coffee-break</a></li>
              <li><a class="dropdown-item" href="menu_for_foto.html">Кейтеринг для зйомок, кіностудій, творчих команд</a></li>
              <li><a class="dropdown-item" href="menu_wedding.html">Весільний кейтеринг</a></li>
              <li><a class="dropdown-item" href="menu_buffets.html">Фуршети</a></li>

              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="menu_banket.html">Банкети</a></li>
              <li><a class="dropdown-item" href="menu_private_parties.html">Приватні вечірки</a></li>
              <li><a class="dropdown-item" href="menu_corporate_events.html">Корпоративні події</a></li>
              <li><a class="dropdown-item" href="menu_bar_catering.html">Барний кейтеринг</a></li>
              <li><a class="dropdown-item" href="menu_B2B_catering.html">B2B кейтеринг</a></li>
              <li><hr class="dropdown-divider"></li>


            </ul>
          </li>
          <li class="nav-item dropdown me-4">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Зробити замовлення
            </a>
          <ul class="dropdown-menu">
            <li><hr class="dropdown-divider"></li>

          <li><a class="dropdown-item" href="online_order.html">Онлайн</a></li>
          <li><a class="dropdown-item" href="phone_order.html">За телефоном</a></li>

        </ul>
      </li>
          <li class="nav-item me-4">
            <a class="nav-link" href="#">Контакти</a>
          </li>

        </ul>

        <ul class="navbar-nav">
          <li class="nav-item login-nav-item">
            <a class="nav-link active" href="login.html">Увійти</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

      <div class="line"></div>
  
  <div class="main">

  <div class="container">
    <h1>Вхід користувача</h1>

    <!-- Форма входу -->
    <div class="form-section" id="login-form">
      <h3>Вхід через Email</h3>
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Пароль" required />
      <button id="email-login">Увійти</button>
      <p>Немає облікового запису? <a href="#" id="show-register">Зареєструватися</a></p>
    </div>

    <!-- Форма реєстрації -->
    <div class="form-section register-form" id="register-form">
      <h3>Реєстрація нового користувача</h3>
      <input type="text" id="username" placeholder="Ім’я користувача" required />
      <input type="email" id="reg-email" placeholder="Email" required />
      <input type="password" id="reg-password" placeholder="Пароль" required />
      <input type="password" id="reg-password-repeat" placeholder="Повторити пароль" required />
      <button id="register-btn">Зареєструватися</button>
      <p>Вже маєте обліковий запис? <a href="#" id="show-login">Увійти</a></p>
    </div>

    <!-- Вхід через Google -->
    <div class="form-section or-section">
      <h3>Або</h3>
      <button id="google-signin">Увійти через Google</button>
    </div>

    <!-- Кнопка виходу -->
    <div class="form-section">
      <button id="logout">Вийти</button>
    </div>
  </div>
</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getAuth,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signInWithPopup,
      signOut,
      GoogleAuthProvider,
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    // Конфігурація Firebase 
    const firebaseConfig = {
      apiKey: "AIzaSyC-7vXgyOD4TZFNKpUGmQheLpY5fQgdA64",
      authDomain: "proect-7468b.firebaseapp.com",
      projectId: "proect-7468b",
      storageBucket: "proect-7468b.appspot.com",
      messagingSenderId: "251531415961",
      appId: "1:251531415961:web:76e6230edb601a22404308",
      measurementId: "G-CSWRQ0EP0G"
    };

    // Ініціалізація Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    provider.setCustomParameters({ prompt: "select_account" });

    // Елементи DOM
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const btnLogin = document.getElementById("email-login");
    const btnLogout = document.getElementById("logout");
    const btnGoogle = document.getElementById("google-signin");

    const regUsername = document.getElementById("username");
    const regEmail = document.getElementById("reg-email");
    const regPassword = document.getElementById("reg-password");
    const regPasswordRepeat = document.getElementById("reg-password-repeat");
    const btnRegister = document.getElementById("register-btn");

    const loginForm = document.getElementById("login-form");
    const registerForm = document.getElementById("register-form");
    const showRegister = document.getElementById("show-register");
    const showLogin = document.getElementById("show-login");

    // Адмінські email
    const admins = ["admin@gmail.com"]; 

    // Перемикання між формами
    showRegister.addEventListener("click", e => {
      e.preventDefault();
      loginForm.style.display = "none";
      registerForm.style.display = "block";
    });

    showLogin.addEventListener("click", e => {
      e.preventDefault();
      registerForm.style.display = "none";
      loginForm.style.display = "block";
    });

    // Вхід через Google
    btnGoogle.addEventListener("click", async (e) => {
      e.preventDefault();
      try {
        const result = await signInWithPopup(auth, provider);
        handleRedirect(result.user);
      } catch (error) {
        alert("Помилка входу через Google: " + error.message);
      }
    });

    // Вхід через Email Пароль
    btnLogin.addEventListener("click", async (e) => {
      e.preventDefault();
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      if (!email || !password) {
        alert("Заповніть всі поля.");
        return;
      }

      try {
        const result = await signInWithEmailAndPassword(auth, email, password);
        handleRedirect(result.user);
      } catch (error) {
        alert("Помилка входу: " + error.message);
        console.error(error);
      }
    });

    // Реєстрація
    btnRegister.addEventListener("click", async (e) => {
      e.preventDefault();
      const username = regUsername.value.trim();
      const email = regEmail.value.trim();
      const password = regPassword.value;
      const repeat = regPasswordRepeat.value;

      if (!username || !email || !password || !repeat) {
        alert("Заповніть усі поля.");
        return;
      }

      if (!email.endsWith("@gmail.com")) {
        alert("Email має бути у домені @gmail.com");
        return;
      }

      if (password !== repeat) {
        alert("Паролі не співпадають.");
        return;
      }

      if (password.length < 6) {
        alert("Пароль повинен містити щонайменше 6 символів.");
        return;
      }

      try {
        const result = await createUserWithEmailAndPassword(auth, email, password);
        await updateProfile(result.user, { displayName: username });
        handleRedirect(result.user);
      } catch (error) {
        if (error.code === "auth/email-already-in-use") {
          alert("Цей email вже зареєстровано.");
        } else {
          alert("Помилка реєстрації: " + error.message);
        }
      }
    });

    // Вихід
    btnLogout.addEventListener("click", async (e) => {
      e.preventDefault();
      await signOut(auth);
      loginForm.style.display = "block";
      registerForm.style.display = "none";
      btnLogout.style.display = "none";
      localStorage.removeItem("userProfile");
    });

    // Функція перенаправлення залежно від ролі
    function handleRedirect(user) {
      if (!user) return;
      const userProfile = {
        name: user.displayName || "Користувач",
        email: user.email,
        phone: user.phoneNumber || ""
      };
      localStorage.setItem("userProfile", JSON.stringify(userProfile));

      if (admins.includes(user.email)) {
        window.location.href = "dishes.html";
      } else {
        window.location.href = "index.html";
      }
    }

    // Стан авторизації
    onAuthStateChanged(auth, (user) => {
      if (user) {
        btnLogout.style.display = "inline-block";
        loginForm.style.display = "none";
        registerForm.style.display = "none";
        handleRedirect(user);
      } else {
        btnLogout.style.display = "none";
        loginForm.style.display = "block";
        registerForm.style.display = "none";
      }
    });

  </script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
